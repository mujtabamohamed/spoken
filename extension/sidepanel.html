<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spoken</title>
    <link rel="stylesheet" href="sidepanel.css" />
  </head>
  <body>
    <div id="app" class="app-container">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <img
            src="spoken-logo.png"
            class="logo-icon"
            alt="Spoken Logo"
          />
          <h1 class="header-title">Spoken</h1>
        </div>
        <button
          id="settingsToggle"
          class="icon-button"
          aria-label="Settings"
          title="Settings"
        >
          <svg
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"
              fill="currentColor"
            />
          </svg>
        </button>
      </header>

      <!-- Settings Panel (Collapsible) -->
      <section
        id="settingsPanel"
        class="settings-panel hidden"
        aria-label="Settings"
      >
        <div class="settings-content">
          <!-- Transcription Mode Toggle -->
          <div class="setting-group">
            <label class="setting-label">Transcription Mode</label>
            <div class="mode-toggle">
              <button id="modeLocal" class="mode-btn active" data-mode="local">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                  <path d="M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/>
                </svg>
                <span>Local (Free)</span>
              </button>
              <button id="modeApi" class="mode-btn" data-mode="api">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                  <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/>
                </svg>
                <span>API (Paid)</span>
              </button>
            </div>
            <p id="modeStatus" class="setting-status status-success">âœ“ Local mode - No API key needed</p>
          </div>

          <!-- Provider Selection (only for API mode) -->
          <div id="providerSection" class="setting-group hidden">
            <label for="providerSelect" class="setting-label">AI Provider</label>
            <select id="providerSelect" class="select">
              <option value="deepgram">Deepgram</option>
              <option value="openai">OpenAI Whisper</option>
            </select>
          </div>

          <!-- API Key (only for API mode) -->
          <div id="apiKeySection" class="setting-group hidden">
            <label for="apiKeyInput" class="setting-label">
              <span id="apiKeyLabel">OpenAI API Key</span>
              <a
                id="apiKeyHelpLink"
                href="https://platform.openai.com/api-keys"
                target="_blank"
                class="help-link"
                title="Get your API key"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  width="14"
                  height="14"
                >
                  <path
                    d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"
                  />
                </svg>
              </a>
            </label>
            <div class="api-key-input-wrapper">
              <input
                type="password"
                id="apiKeyInput"
                class="input"
                placeholder="Enter your API key"
                autocomplete="off"
                spellcheck="false"
              />
              <button
                id="toggleApiKeyVisibility"
                class="icon-button-small"
                aria-label="Toggle visibility"
              >
                <svg id="eyeIcon" viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"
                  />
                </svg>
              </button>
            </div>
            <p id="apiKeyStatus" class="setting-status"></p>
          </div>

          <div class="setting-group">
            <label for="languageSelect" class="setting-label"
              >Transcription Language</label
            >
            <select id="languageSelect" class="select">
              <option value="auto">Auto-detect</option>
              <option value="en">English</option>
              <option value="es">Spanish</option>
              <option value="fr">French</option>
              <option value="de">German</option>
              <option value="it">Italian</option>
              <option value="pt">Portuguese</option>
              <option value="nl">Dutch</option>
              <option value="pl">Polish</option>
              <option value="ru">Russian</option>
              <option value="ja">Japanese</option>
              <option value="ko">Korean</option>
              <option value="zh">Chinese</option>
              <option value="ar">Arabic</option>
              <option value="hi">Hindi</option>
              <option value="ur">Urdu</option>
              <option value="fa">Persian (Farsi)</option>
              <option value="tr">Turkish</option>
              <option value="vi">Vietnamese</option>
              <option value="th">Thai</option>
              <option value="id">Indonesian</option>
              <option value="uk">Ukrainian</option>
              <option value="cs">Czech</option>
              <option value="sv">Swedish</option>
              <option value="da">Danish</option>
              <option value="fi">Finnish</option>
              <option value="no">Norwegian</option>
              <option value="el">Greek</option>
              <option value="he">Hebrew</option>
            </select>
          </div>

          <div class="setting-group">
            <label class="setting-label">
              <input type="checkbox" id="showTimestamps" checked />
              Show timestamps in transcription
            </label>
          </div>

          <div class="settings-actions">
            <button id="saveSettings" class="button button-primary">
              Save
            </button>
            <button id="clearCache" class="button button-secondary">
              Clear Cache
            </button>
          </div>
        </div>
      </section>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Video Info Section -->
        <section id="videoSection" class="video-section">
          <div id="noVideoMessage" class="no-video-message">
            <svg viewBox="0 0 24 24" fill="currentColor" class="no-video-icon">
              <path
                d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM10 8v8l6-4-6-4z"
              />
            </svg>
            <p>Navigate to a YouTube video to begin</p>
          </div>

          <div id="videoInfo" class="video-info hidden">
            <div class="video-thumbnail-wrapper">
              <img
                id="videoThumbnail"
                class="video-thumbnail"
                alt="Video thumbnail"
                loading="lazy"
              />
              <span id="videoDuration" class="video-duration"></span>
            </div>
            <div class="video-details">
              <h2 id="videoTitle" class="video-title">Video Title</h2>
              <p id="videoChannel" class="video-channel"></p>
              <p id="videoUrl" class="video-url"></p>
            </div>
          </div>

          <!-- Status Indicator -->
          <div id="statusIndicator" class="status-indicator hidden">
            <div class="status-icon-wrapper">
              <div id="statusSpinner" class="spinner hidden"></div>
              <svg
                id="statusIconSuccess"
                class="status-icon status-success hidden"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                />
              </svg>
              <svg
                id="statusIconError"
                class="status-icon status-error hidden"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                />
              </svg>
            </div>
            <span id="statusText" class="status-text">Ready</span>
          </div>
        </section>

        <!-- Action Buttons -->
        <section class="action-section">
          <button
            id="transcribeBtn"
            class="button button-primary button-large"
            disabled
          >
            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
              <path
                d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"
              />
            </svg>
            <span><b>Transcribe</b></span>
          </button>

          <!-- Audio File Upload (Alternative) -->
          <div class="upload-section">
            <p class="upload-label">Or upload audio file directly:</p>
            <label for="audioFileInput" class="upload-button">
              <svg
                viewBox="0 0 24 24"
                fill="currentColor"
                width="18"
                height="18"
              >
                <path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z" />
              </svg>
              <span>Choose Audio File</span>
              <input
                type="file"
                id="audioFileInput"
                accept=".mp3,.mp4,.mpeg,.mpga,.m4a,.wav,.webm,.ogg"
                hidden
              />
            </label>
            <span id="selectedFileName" class="selected-file"></span>
          </div>

          <!-- Cost Estimate -->
          <div id="costEstimate" class="cost-estimate hidden">
            <span class="cost-label">Estimated cost:</span>
            <span id="costValue" class="cost-value">$0.00</span>
          </div>
        </section>

        <!-- Transcription Results -->
        <section id="transcriptionSection" class="transcription-section hidden">
          <div class="transcription-header">
            <div class="transcription-header-top">
              <h3 class="transcription-title">Transcription</h3>
              <span id="transcriptionLanguage" class="language-badge" title="Detected Language"></span>
            </div>
            <p id="transcriptionVideoTitle" class="transcription-video-title"></p>
            <div class="transcription-stats">
              <div class="stat-item">
                <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                  <path d="M14 17H4v2h10v-2zm6-8H4v2h16V9zM4 15h16v-2H4v2zM4 5v2h16V5H4z"/>
                </svg>
                <span id="wordCount">0 words</span>
              </div>
              <div class="stat-item">
                <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                  <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/>
                </svg>
                <span id="charCount">0 chars</span>
              </div>
              <div class="stat-item">
                <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                  <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                </svg>
                <span id="transcriptionDuration"></span>
              </div>
              <div class="stat-item">
                <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                  <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/>
                </svg>
                <span id="transcriptionTime"></span>
              </div>
            </div>
          </div>

          <!-- Search -->
          <div class="search-container">
            <div class="search-wrapper">
              <svg class="search-icon" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                />
              </svg>
              <input
                type="text"
                id="searchInput"
                class="search-input"
                placeholder="Search in transcription..."
              />
              <button id="clearSearch" class="clear-search-btn hidden" title="Clear search">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
            <span id="searchResults" class="search-results-badge"></span>
          </div>

          <!-- Transcription Text -->
          <div
            id="transcriptionContent"
            class="transcription-content"
            tabindex="0"
          >
            <p id="transcriptionText" class="transcription-text"></p>
          </div>

          <!-- Action Buttons -->
          <div class="transcription-actions">
            <button
              id="copyBtn"
              class="button button-secondary"
              title="Copy (Ctrl+C)"
            >
              <svg
                viewBox="0 0 24 24"
                fill="currentColor"
                width="18"
                height="18"
              >
                <path
                  d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"
                />
              </svg>
              <span>Copy</span>
            </button>

            <div class="dropdown">
              <button
                id="downloadBtn"
                class="button button-secondary dropdown-trigger"
                title="Download"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  width="18"
                  height="18"
                >
                  <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                </svg>
                <span>Download</span>
                <svg
                  class="dropdown-arrow"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  width="14"
                  height="14"
                >
                  <path d="M7 10l5 5 5-5z" />
                </svg>
              </button>
              <div class="dropdown-menu" id="downloadMenu">
                <button class="dropdown-item" data-format="txt">
                  <span>Text (.txt)</span>
                </button>
                <button class="dropdown-item" data-format="srt">
                  <span>Subtitles (.srt)</span>
                </button>
                <button class="dropdown-item" data-format="vtt">
                  <span>WebVTT (.vtt)</span>
                </button>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- Toast Container -->
      <div id="toastContainer" class="toast-container" aria-live="polite"></div>

      <!-- Keyboard Shortcuts Help -->
      <div id="shortcutsHelp" class="shortcuts-help hidden">
        <h4>Keyboard Shortcuts</h4>
        <ul>
          <li><kbd>T</kbd> Transcribe video</li>
          <li><kbd>C</kbd> Copy transcription</li>
          <li><kbd>F</kbd> Focus search</li>
          <li><kbd>Esc</kbd> Close settings</li>
        </ul>
      </div>
    </div>

    <!-- Scripts -->
    <script src="utils.js"></script>
    <script src="api.js"></script>
    <script src="sidepanel.js"></script>
  </body>
</html>
